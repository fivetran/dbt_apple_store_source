version: 2

sources:
  - name: apple_store # This source will only be used if you are using a single apple_store source connector. If multiple sources are being unioned, their tables will be directly referenced via adapter.get_relation.
    schema: "{{ var('apple_store_schema', 'itunes_connect') }}"
    database: "{% if target.type != 'spark'%}{{ var('apple_store_database', target.database) }}{% endif %}"
    loader: Fivetran
    loaded_at_field: _fivetran_synced

    freshness: 
      warn_after: {count: 48, period: hour}
      error_after: {count: 168, period: hour}

    tables:
      - name: app_store_app
        identifier: "{{ var('apple_store_app_identifier', 'app')}}"
        description: Table containing data about your application(s)
        columns:
          - name: id
            description: '{{ doc("app_id") }}'
          - name: name
            description: '{{ doc("app_name") }}'
          - name: is_enabled
            description: Boolean indicator for whether application is enabled or not.

      - name: sales_account
        identifier: "{{ var('apple_store_sales_account_identifier', 'sales_account')}}"
        description: Table containing sales account data.
        columns: 
          - name: id
            description: '{{ doc("account_id") }}'
          - name: name
            description: '{{ doc("account_name")}}'

      - name: sales_subscription_event_summary
        identifier: "{{ var('apple_store_sales_subscription_event_summary_identifier', 'sales_subscription_event_summary')}}"
        description: Daily subscription event report by account ID, app name, subscription name, event, country, state and device; this model is aggregated by date, app_name, account_id, country, state and subscription_name for easier transformations in the modeling package.
        config:
          enabled: "{{ var('apple_store__using_subscriptions', false) }}"
        columns:
          - name: event_date
            description: '{{ doc("date_day") }}'
          - name: account_number
            description: '{{ doc("account_id") }}'
          - name: app_name
            description: '{{ doc("app_name") }}'
          - name: subscription_name
            description: '{{ doc("subscription_name") }}'
          - name: event
            description: '{{ doc("event") }}'
          - name: country
            description: '{{ doc("country") }}'
          - name: state
            description: '{{ doc("state") }}'
          - name: device
            description: '{{ doc("device") }}'
          - name: quantity
            description: '{{ doc("quantity") }}'

      - name: sales_subscription_summary
        identifier: "{{ var('apple_store_sales_subscription_summary_identifier', 'sales_subscription_summary')}}"
        description: Daily subscription summary report by account ID, app name, country, state and subscription name; this model is aggregated by date, app_name, account_id, country, state and subscription_name for easier transformations in the modeling package.
        config:
          enabled: "{{ var('apple_store__using_subscriptions', false) }}"
        columns:
          - name: _filename
            description: Report filenames used to extract the date of the report
          - name: app_name
            description: '{{ doc("app_name") }}'
          - name: account_number
            description: '{{ doc("account_id") }}'
          - name: country
            description: '{{ doc("country") }}'
          - name: state
            description: '{{ doc("state") }}'
          - name: subscription_name
            description: '{{ doc("subscription_name") }}'
          - name: active_free_trial_introductory_offer_subscriptions
            description: '{{ doc("active_free_trial_introductory_offer_subscriptions") }}'
          - name: active_pay_as_you_go_introductory_offer_subscriptions
            description: '{{ doc("active_pay_as_you_go_introductory_offer_subscriptions") }}'
          - name: active_pay_up_front_introductory_offer_subscriptions
            description: '{{ doc("active_pay_up_front_introductory_offer_subscriptions") }}'
          - name: active_standard_price_subscriptions
            description: '{{ doc("active_standard_price_subscriptions") }}'

      - name: app_store_discovery_and_engagement_detailed_daily
        identifier: "{{ var('apple_store_discovery_and_engagement_detailed_daily_identifier', 'app_store_discovery_and_engagement_detailed_daily') }}"
        description: Contains daily metrics on how users discover and engage with your app on the App Store.
        columns:
          - name: _fivetran_id
            description: Unique identifier assigned by Fivetran.
          - name: app_id
            description: The unique identifier of your app.
          - name: date
            description: The date of the recorded metrics.
          - name: event
            description: The type of user interaction event (e.g., Impression, Page View, Tap).
          - name: page_type
            description: The App Store page where the event occurred (e.g., Today, Games, Apps, Search).
          - name: source_type
            description: The origin from which users discovered your app (e.g., App Store Browse, App Store Search, App Referrers, Web Referrers, App Clips).
          - name: engagement_type
            description: The specific user engagement action (e.g., Tap, Scroll).
          - name: device
            description: The type of device used (e.g., iPhone, iPad, Mac).
          - name: platform_version
            description: The operating system version on the user's device.
          - name: territory
            description: The country or region where the event occurred.
          - name: counts
            description: The total number of events recorded.
          - name: unique_counts
            description: The number of unique devices associated with the events.
          - name: page_title
            description: The title of the App Store page where the event took place.
          - name: source_info
            description: Additional information about the source of the event.
          - name: _fivetran_synced
            description: Timestamp indicating when the data was last synchronized by Fivetran.

      - name: app_crash_daily
        identifier: "{{ var('apple_store_crash_daily_identifier', 'app_crash_daily') }}"
        description: Provides daily data on app crashes, helping you understand app stability across different versions and devices.
        columns:
          - name: _fivetran_id
            description: Unique identifier assigned by Fivetran.
          - name: app_id
            description: The unique identifier of your app.
          - name: date
            description: The date when the crashes were recorded.
          - name: app_version
            description: The version of your app that experienced crashes.
          - name: device
            description: The type of device on which the crash occurred.
          - name: platform_version
            description: The operating system version on the user's device.
          - name: crashes
            description: The total number of crashes recorded.
          - name: unique_devices
            description: The number of unique devices that experienced crashes.
          - name: _fivetran_synced
            description: Timestamp indicating when the data was last synchronized by Fivetran.

      - name: app_store_download_detailed_daily
        identifier: "{{ var('apple_store_download_detailed_daily_identifier', 'app_store_download_detailed_daily') }}"
        description: Contains detailed daily metrics on app downloads, including download types and sources.
        columns:
          - name: _fivetran_id
            description: Unique identifier assigned by Fivetran.
          - name: app_id
            description: The unique identifier of your app.
          - name: date
            description: The date when the downloads were recorded.
          - name: download_type
            description: The type of download event (e.g., First-Time Download, Redownload, Auto-Download, Manual Update, Restore).
          - name: app_version
            description: The version of your app that was downloaded.
          - name: device
            description: The type of device on which the download occurred.
          - name: platform_version
            description: The operating system version on the user's device.
          - name: source_type
            description: The origin from which users discovered your app leading to the download.
          - name: page_type
            description: The App Store page where the download was initiated.
          - name: pre_order
            description: Indicates whether the download was a result of a pre-order.
          - name: territory
            description: The country or region where the download occurred.
          - name: counts
            description: The total number of downloads recorded.
          - name: source_info
            description: Additional information about the source of the download.
          - name: page_title
            description: The title of the App Store page where the download took place.
          - name: _fivetran_synced
            description: Timestamp indicating when the data was last synchronized by Fivetran.

      - name: app_session_detailed_daily
        identifier: "{{ var('apple_store_session_detailed_daily_identifier', 'app_session_detailed_daily') }}"
        description: Provides detailed daily metrics on user sessions within your app, including session duration and device information.
        columns:
          - name: _fivetran_id
            description: Unique identifier assigned by Fivetran.
          - name: app_id
            description: The unique identifier of your app.
          - name: date
            description: The date when the sessions were recorded.
          - name: app_version
            description: The version of your app used during the sessions.
          - name: device
            description: The type of device used during the sessions.
          - name: platform_version
            description: The operating system version on the user's device.
          - name: source_type
            description: The origin from which users discovered your app leading to the session.
          - name: page_type
            description: The App Store page where the session was initiated.
          - name: app_download_date
            description: The date when the app was downloaded on the user's device.
          - name: territory
            description: The country or region where the session occurred.
          - name: sessions
            description: The total number of sessions recorded.
          - name: total_session_duration
            description: The cumulative duration of all sessions in seconds.
          - name: unique_devices
            description: The number of unique devices that initiated sessions.
          - name: source_info
            description: Additional information about the source of the session.
          - name: page_title
            description: The title of the App Store page where the session took place.
          - name: _fivetran_synced
            description: Timestamp indicating when the data was last synchronized by Fivetran.

      - name: app_store_installation_and_deletion_detailed_daily
        identifier: "{{ var('apple_store_installation_and_deletion_detailed_daily_identifier', 'app_store_installation_and_deletion_detailed_daily') }}"
        description: Contains detailed daily metrics on app installations and deletions, providing insights into user acquisition and retention.
        columns:
          - name: _fivetran_id
            description: Unique identifier assigned by Fivetran.
          - name: app_id
            description: The unique identifier of your app.
          - name: date
            description: The date when the installation or deletion event was recorded.
          - name: event
            description: The type of event, either 'Install' or 'Delete'.
          - name: download_type
            description: The type of download event (e.g., First-Time Download, Redownload, Auto-Download, Manual Update, Restore).
          - name: app_version
            description: The version of your app associated with the event.
          - name: device
            description: The type of device on which the event occurred (e.g., iPhone, iPad, Mac).
          - name: platform_version
            description: The operating system version on the user's device.
          - name: source_type
            description: The origin from which users discovered your app leading to the installation or deletion.
          - name: page_type
            description: The App Store page where the event was initiated.
          - name: app_download_date
            description: The date when the app was originally downloaded on the user's device.
          - name: territory
            description: The country or region where the event occurred.
          - name: counts
            description: The total number of installations or deletions recorded.
          - name: unique_devices
            description: The number of unique devices that performed the installation or deletion.
          - name: source_info
            description: Additional information about the source of the event.
          - name: page_title
            description: The title of the App Store page where the event took place.
          - name: _fivetran_synced
            description: Timestamp indicating when the data was last synchronized by Fivetran.
